# 内容

## 为什么读 GFS？
1. 分布式存储是分布式系统十分重要的使用方向
    - 怎么设计接口和语义
    - 内部应该怎么工作
2. 和课程主题相关：高性能，容错，复制(从服务器)，一致性
3. 好的系统论文：详细描述了 apps 到 net 之间的细节
4. 成功的实现了这一设计

## 为什么分布式存储很难实现？
1. 高性能 -> 在多个服务器之间共享数据
2. 多服务器 -> 不间断的单点故障
3. 频繁的节点故障 -> 复制
4. 复制 -> 不能很好地满足一致性
5. 好的一致性 -> 较差的性能

## 保证一致性？
理想情况下：
1. 分布式的服务就好像在同一个服务中一样
2. 服务器使用磁盘进行存储
3. 服务器一次执行一个客户端的操作（即使并发情况下）
4. 会加载历史数据，当服务器崩溃重新启动后


## 通过从服务器来保证容错性很难保证强一致性
一个简单但是弱一致性的方案：两个从服务器，S1 和 S2。客户端会同时向这两个服务器写入，但只会从任意一个服务器读取。
如果客户端发送了 S1 的写入请求，但是在发送 S2 时崩溃，这样二者就不一致了。如果想要保证服务器之间的一致性，需要频繁的进行同步操作，这样的话就会影响性能。
所以需要在一致性和性能之间进行权衡。

## GFS 内容：
1. Google 中许多服务需要一个大型的快速统一的存储系统：MapReduce、网页爬虫/索引、日志存储分析系统、youtube？ 等等
2. 全局(通过单个节点)：任何用户可以读取系统中的任何文件。允许在应用之间共享数据
3. 自动故障恢复
4. 每个部署只存在一个数据中心
5. 仅是 Google 的应用和用户
6. 目的在于大型文件的连续访问、读取或追加

## 整体架构
1. 客户端（数据库，RPC）
2. 每个文件拆分多个为 64MB 大小的块
3. 每个块在三台服务器上进行备份。这样做可以并行读写，且支持大文件

## 客户端读取一个文件的步骤
1. 客户端发送文件名称和偏移量给主服务器 M
2. M 根据偏移量找到第一个需要的数据块的句柄
3. M 把保存了该数据块的服务器列表发送给客户端
4. 客户端缓存服务器列表
5. 客户端从最近的服务器请求数据块
6. 块服务器从磁盘读取文件并返回可客户端

## 客户端想要追加记录时如何操作
1. 客户端从主服务器 M 中获取最后一个数据块的句柄